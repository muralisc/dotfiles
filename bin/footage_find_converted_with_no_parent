#!/bin/bash
# This script is used to find the jpg for which the CR3 has been deleted

# e.g:
#   bash ~/src/dotfiles/bin/footage_find_jpg_wih_no_cr3 ~/data/footage/2021

SRC_DIR=${1:-~/data/footage/2022}
echo "Using source : $SRC_DIR"

COST="0"
for file_path in $(find $SRC_DIR -iname "*jpg" -ipath "*converted*"); do
  root_path=$(dirname $file_path)
  jpg_filename=$(basename $file_path)
  # check if extension is small case or CAPS
  if grep jpg <<< $file_path > /dev/null ; then
    jpg_filename_nosuffix=$(basename $file_path .jpg)
  else
    jpg_filename_nosuffix=$(basename $file_path .JPG)
  fi
  orig_file="${jpg_filename_nosuffix}.CR3"
  if [[ ! -f $root_path/../$orig_file ]] ; then
    echo "Original File not found for :" $file_path
    COST+="+$(du $file_path | awk '{print $1}')"
  else
    # echo "Converted File not found for :" $file_path
    :
  fi
done
echo "Duplicate file cost:"
echo $COST | bc | numfmt --to=iec

