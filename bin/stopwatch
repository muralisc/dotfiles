#!/bin/bash

STOPWATCH_FILENAME=/var/tmp/stopwatch.tmp
# stopwatch_status()
stopwatch_start(){
  # urxvtc -geometry 20x1
  startDate=$(date +%s);
  echo $startDate > $STOPWATCH_FILENAME
  stopwatch_lap
}
stopwatch_follow(){
  startDate=$(cat $STOPWATCH_FILENAME);
  while true; do
   currentTime=$(date +%s)
   diff=$(date -u --date @$((currentTime - $startDate)) +%H:%M:%S)
   echo -ne "$diff\b\b\b\b\b\b\b\b";
   sleep 1
  done
}
stopwatch_lap() {
  [ ! -f $STOPWATCH_FILENAME ] && { echo -ne "nil" ; return ; }
  startDate=$(cat $STOPWATCH_FILENAME);
  currentTime=$(date +%s)
  diff=$(date -u --date @$((currentTime - $startDate)) +%H:%M:%S)
  echo -ne "$diff"
}
stopwatch_stop(){
  rm -rf $STOPWATCH_FILENAME
}

case $1 in
  start)
    stopwatch_start
    ;;
  follow)
    stopwatch_follow
    ;;
  lap)
    stopwatch_lap
    ;;
  stop)
    stopwatch_stop
    ;;
  *)
    echo -e "Usage \n 1. start \n 2. follow\n 3. lap\n4. stop\n"
    ;;
esac
