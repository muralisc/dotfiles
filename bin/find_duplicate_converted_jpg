#!/bin/bash
# This script is used to find the jpg which is also converted into jpg 
# along with cr3 raw files
# The duplicate jpg files can be deleted if the size they consume is high

# e.g:
#   bash ~/src/dotfiles/bin/find_duplicate_converted_jpg ~/data/footage/2021

SRC_DIR=${1:-~/data/footage/2021}
echo "Using source : $SRC_DIR"

COST="0"
for file_path in $(find $SRC_DIR -iname "*jpg" -not -ipath "*converted*"); do
  root_path=$(dirname $file_path)
  jpg_filename=$(basename $file_path)
  # check if extension is small case or CAPS
  if grep jpg <<< $file_path > /dev/null ; then
    jpg_filename_nosuffix=$(basename $file_path .jpg)
  else
    jpg_filename_nosuffix=$(basename $file_path .JPG)
  fi
  converted_file="converted/${jpg_filename_nosuffix}.jpg"
  if [[ -f $root_path/$converted_file ]] ; then
    echo "Converted File found for :" $file_path
    COST+="+$(du $file_path | awk '{print $1}')"
  else
    # echo "Converted File not found for :" $file_path
    :
  fi
done
echo "Duplicate file cost:" $COST | bc | numfmt --to=iec
